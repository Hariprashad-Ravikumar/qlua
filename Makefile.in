# There is no PREFIX in this makefile, use configure to change the
# installation locations.
V = 0
.PHONY: all doc lib clean realclean install

BINDIR       = @bindir@
LIBDIR       = @libdir@
INCDIR       = @incdir@
DOCDIR       = @docdir@

CC           = @cc@
COPTS        = @copts@
CFLAGS       = @cflags@

LD           = @ld@
LDFLAGS      = @ldflags@
LIBS         = @libs@

AR           = @ar@
RANLIB       = @ranlib@

LUA          = @lua@

QDP          = @qdp@
QDP_CF       = @qdp_cflags@
QDP_LF       = @qdp_ldflags@
QDP_LIBS     = @qdp_libs@

AFF          = @aff@
AFF_CF       = @aff_cflags@
AFF_LF       = @aff_ldflags@
AFF_LIBS     = @aff_libs@

CLOVER       = @clover@
CLOVER_CF    = @clover_cflags@
CLOVER_LF    = @clover_ldflags@
CLOVER_LIBS  = @clover_libs@

MDWF         = @mdwf@
MDWF_CF      = @mdwf_cflags@
MDWF_LF      = @mdwf_ldflags@
MDWF_LIBS    = @mdwf_libs@

## add other modules here

#############################################################################
library = libqlua.a
driver = qlua.c
headers = qlua.h
libsrc = init.c \
         qvector.c \
         qcomplex.c

drvobj = $(driver:%.c=%.o)
libobj = $(libsrc:%.c=%.o)
program = $(driver:%.c=%)

#############################################################################
ifeq ("$V", "0")
   E=@echo "  "
   C=@
else
   E=@echo > /dev/null ""
   C=
endif

CCMD  = $(CC) -c $(COPTS) $(LUA:%=-I%/include) \
              $(CFLAGS) $(QDP_CF) $(AFF_CF) $(CLOVER_CF) $(MDWF_CF)
LCMD  = $(LD) $(LDFALGS) $(LUA:%=-L%/lib) \
              $(QDP_LF) $(AFF_LF) $(CLOVER_LF) $(MDWF_LF)
LLIBS = $(MDWF_LIBS) $(CLOVER_LIBS) $(AFF_LIBS) $(QDP_LIBS) $(LIBS) -llua

###############################################################################
all: doc $(program)

doc:

lib: $(library)

clean:
	$ECLEAN objects
	$C$(RM) $(drvobj) $(libobj) $(library)

realclean: clean
	$ECLEAN executables
	$C$(RM) $(program)

install:
###############################################################################
$(program): $(drvobj) $(library)
	$ELD $(program)
	$C$(LCMD) -o $(program) $(drvobj) -L. $(library:lib%.a=-l%) $(LLIBS)

$(drvobj) $(libobj): %.o: sources/%.c
	$ECC $@
	$C$(CCMD) -Isources -o $@ $<

$(library): $(libobj)
	$EAR $(library)
	$C$(AR) cr $(library) $(libobj)
	$C$(RANLIB) $(library)

$(drvobj) $(libobj): Makefile
$(drvobj) $(libobj): sources/qlua.h
init.o: sources/qvector.h sources/qcomplex.h
qvector.o: sources/qvector.h
qcomplex.o: sources/qcomplex.h
