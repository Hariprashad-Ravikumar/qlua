# There is no PREFIX in this makefile, use configure to change the
# installation locations.
V = 0
.PHONY: all doc lib clean realclean install

BINDIR       = @bindir@
LIBDIR       = @libdir@
INCDIR       = @incdir@
DOCDIR       = @docdir@

CC           = @cc@
COPTS        = @copts@
CFLAGS       = @cflags@

LD           = @ld@
LDFLAGS      = @ldflags@
LIBS         = @libs@

AR           = @ar@
RANLIB       = @ranlib@

LUA          = @lua@

QDP          = @qdp@
QDP_CF       = @qdp_cflags@
QDP_LF       = @qdp_ldflags@
QDP_LIBS     = @qdp_libs@

AFF          = @aff@
AFF_CF       = @aff_cflags@
AFF_LF       = @aff_ldflags@
AFF_LIBS     = @aff_libs@

CLOVER       = @clover@
CLOVER_CF    = @clover_cflags@
CLOVER_LF    = @clover_ldflags@
CLOVER_LIBS  = @clover_libs@

MDWF         = @mdwf@
MDWF_CF      = @mdwf_cflags@
MDWF_LF      = @mdwf_ldflags@
MDWF_LIBS    = @mdwf_libs@

## add other modules here

#############################################################################
library = libqlua.a
driver = qlua.c
headers = qlua.h
libsrc = qvector.c \
         qcomplex.c \
         qgamma.c \
         latint.c \
         latrandom.c \
         latreal.c \
         latcomplex.c \
         latcolvec.c \
	 latcolmat.c \
         latdirferm.c \
         latdirprop.c

drvobj = $(driver:%.c=%.o)
libobj = $(libsrc:%.c=%.o)
program = $(driver:%.c=%)

#############################################################################
ifeq ("$V", "0")
   E=@echo "  "
   C=@
else
   E=@echo > /dev/null ""
   C=
endif

CCMD  = $(CC) -c $(COPTS) $(LUA:%=-I%/include) \
              $(CFLAGS) $(QDP_CF) $(AFF_CF) $(CLOVER_CF) $(MDWF_CF)
LCMD  = $(LD) $(LDFALGS) $(LUA:%=-L%/lib) \
              $(QDP_LF) $(AFF_LF) $(CLOVER_LF) $(MDWF_LF)
LLIBS = $(MDWF_LIBS) $(CLOVER_LIBS) $(AFF_LIBS) $(QDP_LIBS) $(LIBS) -llua

###############################################################################
all: doc $(program)

doc:

lib: $(library)

clean:
	$ECLEAN objects
	$C$(RM) $(drvobj) $(libobj) $(library)

realclean: clean
	$ECLEAN executables
	$C$(RM) $(program)

install:
###############################################################################
$(program): $(drvobj) $(library)
	$ELD $(program)
	$C$(LCMD) -o $(program) $(drvobj) -L. $(library:lib%.a=-l%) $(LLIBS)

$(drvobj) $(libobj): %.o: sources/%.c
	$ECC $@
	$C$(CCMD) -Isources -o $@ $<

$(library): $(libobj)
	$EAR $(library)
	$C$(AR) cr $(library) $(libobj)
	$C$(RANLIB) $(library)

$(drvobj) $(libobj): Makefile
$(drvobj) $(libobj): sources/qlua.h
qlua.o: $(libsrc:%.c=sources/%.h)

### output from utils/get-deps
latcolmat.o: sources/latcolmat.h
latcolmat.o: sources/qcomplex.h
latcolmat.o: sources/latint.h
latcolmat.o: sources/latrandom.h
latcolmat.o: sources/latcomplex.h
latcolmat.o: sources/latcolvec.h
latcolvec.o: sources/latcolvec.h
latcolvec.o: sources/qcomplex.h
latcolvec.o: sources/latint.h
latcolvec.o: sources/latcomplex.h
latcolvec.o: sources/latrandom.h
latcomplex.o: sources/latcomplex.h
latcomplex.o: sources/latreal.h
latcomplex.o: sources/latint.h
latcomplex.o: sources/latrandom.h
latcomplex.o: sources/qcomplex.h
latdirferm.o: sources/qcomplex.h
latdirferm.o: sources/latint.h
latdirferm.o: sources/latrandom.h
latdirferm.o: sources/latcomplex.h
latdirferm.o: sources/latcolvec.h
latdirferm.o: sources/latcolmat.h
latdirferm.o: sources/latdirferm.h
latint.o: sources/latint.h
latrandom.o: sources/latint.h
latrandom.o: sources/latrandom.h
latrandom.o: sources/latreal.h
latrandom.o: sources/latcomplex.h
latrandom.o: sources/latcolvec.h
latrandom.o: sources/latcolmat.h
latrandom.o: sources/latdirferm.h
latreal.o: sources/latreal.h
latreal.o: sources/latint.h
latreal.o: sources/latrandom.h
latreal.o: sources/latcomplex.h
qcomplex.o: sources/qcomplex.h
qvector.o: sources/qcomplex.h
qvector.o: sources/qvector.h
latcolmat.o: sources/latcolmat.h
latcolmat.o: sources/qcomplex.h
latcolmat.o: sources/latint.h
latcolmat.o: sources/latrandom.h
latcolmat.o: sources/latcomplex.h
latcolmat.o: sources/latcolvec.h
latcolvec.o: sources/latcolvec.h
latcolvec.o: sources/qcomplex.h
latcolvec.o: sources/latint.h
latcolvec.o: sources/latcomplex.h
latcolvec.o: sources/latrandom.h
latcomplex.o: sources/latcomplex.h
latcomplex.o: sources/latreal.h
latcomplex.o: sources/latint.h
latcomplex.o: sources/latrandom.h
latcomplex.o: sources/qcomplex.h
latdirferm.o: sources/qcomplex.h
latdirferm.o: sources/latint.h
latdirferm.o: sources/latrandom.h
latdirferm.o: sources/latcomplex.h
latdirferm.o: sources/latcolvec.h
latdirferm.o: sources/latcolmat.h
latdirferm.o: sources/latdirferm.h
latdirprop.o: sources/qcomplex.h
latdirprop.o: sources/latcolmat.h
latdirprop.o: sources/latdirferm.h
latdirprop.o: sources/latdirprop.h
latdirprop.o: sources/latrandom.h
latdirprop.o: sources/latcomplex.h
latdirprop.o: sources/latint.h
latint.o: sources/latint.h
latrandom.o: sources/latint.h
latrandom.o: sources/latrandom.h
latrandom.o: sources/latreal.h
latrandom.o: sources/latcomplex.h
latrandom.o: sources/latcolvec.h
latrandom.o: sources/latcolmat.h
latrandom.o: sources/latdirferm.h
latrandom.o: sources/latdirprop.h
latreal.o: sources/latreal.h
latreal.o: sources/latint.h
latreal.o: sources/latrandom.h
latreal.o: sources/latcomplex.h
qcomplex.o: sources/qcomplex.h
qgamma.o: sources/qcomplex.h
qgamma.o: sources/qgamma.h
qgamma.o: sources/latdirferm.h
qgamma.o: sources/latdirprop.h
qvector.o: sources/qcomplex.h
qvector.o: sources/qvector.h
### end of utils/get-deps output
