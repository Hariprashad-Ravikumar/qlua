require "stdlib"

function show_table(n, x0, t)
   local i, j, x, v
   printf("result(%s)\n", n)
   if x0 then
      for i = 1, #x0 do
         printf("  x[%2d] = %g\n", i, x0[i])
      end
   end
   for i, v in pairs(t) do
      printf("  .%-20s: %s\n", i, tostring(v))
   end
   local log = t.Logs
   if log then
      for i, v in pairs(log) do
         printf("  .Log.%-20s: %s\n", i, tostring(v))
      end
      for i = 1, t.Iterations do
         printf("   %5d %20.10e %12.4e :", i, log.f[i], log.size[i])
         x = log.x[i]
         for j = 1, #x do
            printf(" %15.8e", x[j])
         end
         printf("\n")
      end
   end
end

function h2(x,y)
   -- printf("...........h2(%g,%g)\n", x, y)
   local xz = x + 4.5
   local yz = y + 1.2
   return xz * xz + 636 * yz * yz * yz * yz
end

function s2(x,y)
   -- printf("...........s2(%g,%g)\n", x, y)
   return math.sin(math.pi*x) + math.cos(math.pi*y)
end

x,st = gsl.min.nmsimplex{MaxIterations = 1234,
                         RelativeError = 1e-5,
                         AbsoluteError = 1e-200,
                         Logging = true}(h2,{3,4})
show_table("nmsimplex", x, st)
x, st = gsl.min.nmsimplex2{AbsoluteError = 1e-8}(s2,{0.3,0.4})
show_table("abs, nmsimplex2", x, st)

x, st = gsl.min.nmsimplex2rand{AbsoluteError = 1e-8}(s2,{0.3,0.4})
show_table("abs, nmsimplex2rand", x, st)
