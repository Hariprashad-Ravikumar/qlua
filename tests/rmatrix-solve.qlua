require "stdlib"

S = qcd.RandomState(34, 76457)
size = 532
eps = 1e-17 * size * size

m = matrix.real{size, size}
f = vector.real(size)

for i = 0, size - 1 do
   f[i] = S:gaussian_Real()
   for j = 0, size - 1 do
	  m[{i,j}] = S:gaussian_Real()
   end
end

z = m:solve(f)

ok = true
for i = 0, size - 1 do
   local s = f[i]
   for j = 0, size - 1 do
	  s = s - m[{i,j}] * z[j]
   end
   if math.abs(s) > eps then
	  ok = false
	  printf("%5d %20.8e -- bad\n", i, s)
   end
end

if ok then
   printf("DONE\n")
else
   printf("real martix solve failed\n");
   os.exit(1)
end