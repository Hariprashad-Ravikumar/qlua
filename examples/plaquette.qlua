-- compute ij plaquette on each lattice site

function plaquette(i, j, U)
   local d = #U
   assert(i >= 0 and i < d, "plaquette index out of range")
   assert(j >= 0 and j < d, "plaquette index out of range")
   assert(not i == j, "collapsed plaquette")

   return U[i+1] *
          U[j+1]:shift(i, "from_forward") *
          U[i+1]:shift(j, "from_forward"):adjoin() *
          U[j+1]:adjoin()
end
